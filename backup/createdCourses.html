{% extends 'base.html' %}

{% block content %}
<ul class="nav nav-tabs">
		<li class="active"><a href="/Instructor/createdCourses/">View Created Courses</a></li>
		<li><a href="/Instructor/createCourse/">Create New Course</a></li>
		<li><a href="/accounts/logout/">Log-out</a></li>
</ul>
<h1>Created Courses</h1>
	<div>
		<span>Select Category:</span>
		<select class="category_select" onchange="category_select()">
			<option value="all">All</option>
			{% for cata in categorys %}
				<option value="{{ cata.id }}">{{ cata.name }}</option>
			{% endfor %}
		</select>
		<button id="category_submit"><a href="?category=all">search</a></button>
	</div>
	<table class="table table-striped table-hover">
		<tr>
			<th>Name</th>
			<th>Description</th>
			<th>Release</th>
		</tr>
		{% for c in courses %}
		<tr>
				<td> <a href="/Instructor/createdCourses/?courseID={{c.id}}">{{ c.name }} </td>
				<td> {{ c.description }} </td>
				<td> 
					{% if c.is_opened %}
						<span style="color:000;">Released</span>
					{% else %}
						<button id="{{c.id}}" class="btn btn-danger release_btn">Release</button>
					{% endif %}
				 </td>
		</tr>
		{% endfor %}
	</table>
	<div class="modal" id="warning-modal">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	        <h4 class="modal-title">Confirm</h4>
	      </div>
	      <div class="modal-body">
	        <p>You want to release this course? </p>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	        <button type="button" class="btn btn-warning release_submit_btn">Save changes</button>
	      </div>
	    </div>
	  </div>
	</div>

	<script>

		api = "http://127.0.0.1:8000/";
		$(".role_selection li").removeClass("active");
		$("#instructor").addClass("active");
		function category_select(){
			$("#category_submit a").attr("href","?category="+$(".category_select").val());
		}
		$(".release_btn").click(function() {
  			$("#warning-modal").modal('show');
  			$(".release_submit_btn").attr("id",$(this).attr("id"));
		});

		$(".release_submit_btn").click(function() {
			courseID = $(this).attr("id");
			$.ajax({
				type: "POST",
				url: api +"Instructor/releaseCourse/",
				data:{ 
					releaseCourseID:courseID,
					csrfmiddlewaretoken: '{{ csrf_token }}' },
				success:function(msg){
					if(msg=="success")
						console.log("success");
					$(".warning-modal").modal('hide');
					location.reload();
					
				},complete:function(){
					console.log("complete");
				},
    			error:function (xhr, textStatus, thrownError){
        			alert("error:"+thrownError);
    			}

			});
  			$("#release_submit_btn").attr("course",$(this).attr('id'))
		});


	</script>
{% endblock %}
