{% extends 'base.html' %}

{% block content %}
<ul class="nav nav-tabs">
		<li><a href="/Admin/userPermission/">Manage User Permission</a></li>
		<li class="active"><a href="/Admin/manageCategory/">Manage Category</a></li>
</ul>
<h1>Manage User Permission</h1>
	<div>

		<button class="btn btn-warning" id="createCategory_btn">Create Category</button>

	</div>
	<table class="table table-striped table-hover">
		<tr>
			<th>Category</th>
			<th>Action</th>
		</tr>
		{% for c in category %}
		<tr>
			<td>{{ c.name }}</td>
			<td>	
				<button class="btn btn-success renameCategory" id="{{c.id}}">Rename</button>
				<button class="btn btn-danger deleteCategory" id="{{c.id}}">Delete</button>
			</td>
		</tr>
		{% endfor %}
	</table>
	<div class="modal" id="newCategory-modal">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	        <h4 class="modal-title">Create Category</h4>
	      </div>
	      <div class="modal-body form-group">
	      	{% csrf_token %}
	        <input id="newCategory" name="newCategory" type="text" class="form-control input-lg" placeholder="Enter category name" />

	      </div>
	      <div class="modal-footer form-group">
	        <button type="reset" class="btn btn-default" data-dismiss="modal">Close</button>
	        <button class="btn btn-warning modal_submit_btn">Save changes</button>
	      </div>
	    </div>
	  </div>
	</div>

	<script>

		api = "http://127.0.0.1:8000/";
		$(".role_selection li").removeClass("active");
		$("#admin").addClass("active");

		$("#createCategory_btn").click(function() {
			$(".modal-title").html("Create Category");
			$("#newCategory").val("");
  			$(".modal_submit_btn").removeClass("renameCategory_btn");
  			$(".modal_submit_btn").addClass("category_create_btn");
  			$("#newCategory-modal").modal('show');
		});

		$(".renameCategory").click(function() {
			$(".modal-title").html("Rename Category");
			$("#newCategory").val("");
			$(".modal_submit_btn").attr("Cid",$(this).attr("id"));
			$(".modal_submit_btn").removeClass("category_create_btn");
			$(".modal_submit_btn").addClass("renameCategory_btn");
			$("#newCategory-modal").modal('show');
		});
		
		$(".modal_submit_btn").click(function() {	//create category

			if($(this).hasClass("renameCategory_btn")){
				renameCategoryID = $(this).attr("Cid");
				renameCategory = $("#newCategory").val();
				$.ajax({
					type: "POST",
					url: api +"Admin/editCategory/",
					data:{
						renameCategory:renameCategory,
						renameCategoryID:renameCategoryID,
						csrfmiddlewaretoken: '{{ csrf_token }}' },
					success:function(msg){
						window.location.reload();
						
					},
	    			error:function (xhr, textStatus, thrownError){
	        			alert("error:"+thrownError);
	    			}

				});
			}

			else if($(this).hasClass("category_create_btn")){
				newCategoryName = $("#newCategory").val();
				$.ajax({
					type: "POST",
					url: api +"Admin/editCategory/",
					data:{
						newCategoryName:newCategoryName,
						csrfmiddlewaretoken: '{{ csrf_token }}' },
					success:function(msg){
						if(msg=="success")
							console.log("success");
						$(".newCategory-modal").modal('hide');
						window.location.reload();
						
					},
	    			error:function (xhr, textStatus, thrownError){
	        			alert("error:"+thrownError);
	    			}
				});


			}
		});



		$(".deleteCategory").click(function() {	//create category
			deleteCategory = $(this).attr("id");
			console.log(deleteCategory);
			$.ajax({
				type: "POST",
				url: api +"Admin/editCategory/",
				data:{
					deleteCategory:deleteCategory,
					csrfmiddlewaretoken: '{{ csrf_token }}' },
				success:function(msg){
					window.location.reload();
					
				},
    			error:function (xhr, textStatus, thrownError){
        			alert("error:"+thrownError);
    			}

			});
		});

	</script>
{% endblock %}
